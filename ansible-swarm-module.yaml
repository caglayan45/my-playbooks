---
  - hosts: all
    become: true
    become_method: sudo
    become_user: ec2-user
    tasks:
      - name: INIT SWARM (ILK NODE ICIN)
        community.docker.docker_swarm:
          state: present
          advertise_addr: "{{ ansible_host }}"
        register: result
        when: inventory_hostname == groups['manager'][0]

      - name: YONETICI NODE TOKEN (join_token_manager)
        set_fact:
          join_token_smanager: "{{ hostvars[groups['manager'][0]].result.swarm_facts.JoinTokens.Manager }}"

      - name: WORKER NODELAR TOKEN (join_token_worker)
        set_fact:
          join_token_worker: "{{ hostvars[groups['manager'][0]].result.swarm_facts.JoinTokens.Worker }}"

      - name: WORKER NODELARIN SWARMA KATILIMI
        community.docker.docker_swarm:
          state: join
          join_token: "{{ join_token_worker }}"
          advertise_addr: "{{ ansible_host }}"
          remote_addrs: "{{ hostvars[groups['manager'][0]].ansible_host }}"
        when:
          - inventory_hostname in groups['workers']

